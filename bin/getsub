#!/usr/bin/env ruby

require 'optparse'
require 'uri'
require File.join(File.dirname(__FILE__), '..', 'lib', 'osdb')

def env_lang
  OSDb::Language.from_locale(ENV['LANG'])
end

options = OSDb.parse_options

def group_by_movie_name(subs)
  subs.inject({}) do |hash, sub| 
    hash[sub.movie_name] ||= []
    hash[sub.movie_name] << sub
    hash
  end
end

def ask_user_to_identify_movie(movies)
  puts "D'oh! You stumbled upon a hash conflict, please resolve it:"
  puts
  movies.keys.each_with_index do |name, index|
    puts " #{index} - #{name}"
  end
  puts
  print 'id: '
  str = STDIN.gets
  movies[movies.keys[str.to_i]]
end

STDOUT.sync = true

if !options[:dir] && ARGV.empty?
  puts OSDb.help
  exit 1
end

OSDb::Sub.fetch